<!DOCTYPE html>
<html lang="en">
<head>
    <title>Hotel Orders</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/hotel-orders.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<a href="/hotel/dashboard"> â¬… Back to Dashboard</a>
<div class="container mt-4">
    <h3 class="text-center mb-4">Hotel Orders</h3>

    <!-- ðŸ” Search -->
    <form method="get" class="row mb-3 justify-content-center">
        <div class="col-md-4">
            <input
                type="text"
                name="phone"
                value="{{ search_phone }}"
                placeholder="Search by phone"
                class="form-control"
            >
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary w-100">Search</button>
        </div>
    </form>

    {% if orders %}
    <div class="table-responsive">
        <table class="table table-bordered table-hover bg-white align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>User</th>
                    <th>Items</th>
                    <th>Amount</th>
                    <th>Payment</th>
                    <th>QR Verify</th>
                    <th>Action</th>
                </tr>
            </thead>

            <tbody>
            {% for o in orders %}
                <tr>
                    <!-- ðŸ‘¤ User -->
                    <td>
                        <strong>{{ o.full_name }}</strong><br>
                        {{ o.phone }}<br>
                        {% if o.is_premium %}
                            <span class="badge bg-warning text-dark mt-1">Premium</span>
                        {% endif %}
                    </td>

                    <!-- ðŸ½ Items -->
                    <td>
                        <ul class="mb-0 ps-3">
                            {% for item in o.order_items %}
                                <li>{{ item.name }} Ã— {{ item.qty }}</li>
                            {% endfor %}
                        </ul>
                    </td>

                    <!-- ðŸ’° Amount -->
                    <td class="text-center">
                        â‚¹{{ o.total_amount }}
                    </td>

                    <!-- ðŸ’³ Payment -->
                    <td class="text-center">
                        <span class="badge bg-info text-dark">
                            {{ o.payment_mode|upper }}
                        </span>
                    </td>

                    <!-- âœ… QR Verify -->
                    <td>
                        <form method="post" action="{{ url_for('hotel.complete_order') }}">
                            <input type="hidden" name="order_id" value="{{ o.id }}">

                            {% if o.is_late %}
                                <div class="alert alert-warning p-1 text-center mb-1">
                                    Late order<br>
                                    QR not required
                                </div>
                            {% endif %}

                            <input
                                type="text"
                                name="qr_code"
                                placeholder="QR code (optional if late)"
                                class="form-control mb-1"
                            >

                            <button class="btn btn-success btn-sm w-100">
                                Complete
                            </button>
                        </form>
                    </td>

                    <!-- ðŸš« Report User -->
                    <td class="text-center">
                        {% if o.payment_mode == 'cod' and o.is_premium %}
                        <form
                            method="post"
                            action="{{ url_for('hotel.report_user') }}"
                            onsubmit="return confirmReport();"
                        >
                            <input type="hidden" name="user_id" value="{{ o.user_id }}">
                            <input type="hidden" name="order_id" value="{{ o.id }}">

                            <button class="btn btn-danger btn-sm w-100">
                                Report User
                            </button>
                        </form>
                        {% else %}
                            â€”
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    {% else %}
        <p class="text-center text-muted">No active orders</p>
    {% endif %}

    <div class="text-center mt-3">
        
    </div>
</div>

<!-- ðŸ”” Confirmation Script -->
<script>
function confirmReport() {
    return confirm(
        "Are you sure you want to report this user?\n\n" +
        "â€¢ This action cannot be undone\n" +
        "â€¢ The order will be marked as completed\n" +
        "â€¢ Repeated reports may revoke premium access"
    );
}
</script>

</body>
</html>
